<ng-container *ngIf="layout.isDrawerNav; else navTpl">
    <nz-drawer
        *ngIf="layout.isDrawerNav; else navTpl"
        [nzWidth]="layout.navWidth"
        [nzVisible]="shown"
        (nzOnClose)="shown = false"
        [nzClosable]="false"
        [nzBodyStyle]="{ padding: 0 }"
        nzPlacement="left"
    >
        <ng-template nzDrawerContent>
            <ng-container *ngTemplateOutlet="navTpl"></ng-container>
        </ng-template>
    </nz-drawer>
</ng-container>

<div
    *ngIf="layout.isCompactNav"
    class="nav_secondLevelPanel"
    [class.nav_secondLevelPanel-open]="secondLevelPanelOpened"
    [class.scrollbar-small]="hasSmartScrollbars"
    [class.scrollbar-dark]="hasSmartScrollbars"
    (mouseenter)="handleFirstLevelItemHover()"
    (mouseleave)="handleFirstLevelItemLeave()"
>
    <ng-container *ngIf="secondLevelPanelOpened">
        <div class="nav_secondLevelPanelHeader">
            {{ openedItems[0].label }}
        </div>

        <ng-container
            *ngTemplateOutlet="
                secondLevelListTpl;
                context: { $implicit: openedItems[0] }
            "
        ></ng-container>
    </ng-container>
</div>

<ng-template #navTpl>
    <div
        class="nav_wrapper"
        [class.scrollbar-small]="hasSmartScrollbars"
        [class.scrollbar-dark]="hasSmartScrollbars"
    >
        <div class="nav_header">
            <div
                class="nav_iconWrapper nav_toggle cursorPointer"
                (click)="toggleDisplay()"
            >
                <i nz-icon nzType="picto:bars" class="nav_icon"></i>
            </div>
            <div class="nav_headerLabel textEllipsis">{{ title }}</div>
        </div>
        <div class="nav_itemList nav_itemList-firstLevel">
            <ng-container *ngFor="let firstLevelItem of categories">
                <ng-container *ngIf="!firstLevelItem.hidden">
                    <a
                        *ngIf="firstLevelItem.route; else firstLevelItemTpl"
                        [routerLink]="firstLevelItem.route.path"
                        [queryParams]="firstLevelItem.route.queryParams"
                        class="nav_link"
                    >
                        <ng-container
                            *ngTemplateOutlet="firstLevelItemTpl"
                        ></ng-container>
                    </a>
                    <ng-template #firstLevelItemTpl>
                        <div
                            class="nav_item nav_item-firstLevel"
                            [class.nav_item-active]="
                                activeNavItems.includes(firstLevelItem)
                            "
                            [class.nav_item-open]="
                                openedItems.includes(firstLevelItem)
                            "
                            [style]="getFirstLevelItemStyles(firstLevelItem)"
                            (click)="handleItemClick(firstLevelItem, 1)"
                            (mouseenter)="
                                handleFirstLevelItemHover(firstLevelItem)
                            "
                            (mouseleave)="handleFirstLevelItemLeave()"
                        >
                            <div class="nav_iconWrapper">
                                <i
                                    nz-icon
                                    [nzType]="firstLevelItem.icon"
                                    class="nav_icon"
                                ></i>
                            </div>
                            <div class="nav_itemLabel">
                                {{ firstLevelItem.label }}
                            </div>
                            <i
                                *ngIf="
                                    firstLevelItem.route == null &&
                                    firstLevelItem.children != null &&
                                    firstLevelItem.children.length > 0
                                "
                                nz-icon
                                nzType="picto:angle-down"
                                class="nav_iconChild"
                            ></i>
                        </div>
                    </ng-template>
                    <ng-container
                        *ngIf="
                            !layout.isCompactNav &&
                            firstLevelItem.children != null &&
                            firstLevelItem.children.length > 0
                        "
                    >
                        <ng-container
                            *ngTemplateOutlet="
                                secondLevelListTpl;
                                context: { $implicit: firstLevelItem }
                            "
                        ></ng-container>
                    </ng-container>
                </ng-container>
            </ng-container>
        </div>
    </div>
</ng-template>

<ng-template #secondLevelListTpl let-firstLevelItem>
    <div
        class="nag_itemList nav_itemList-secondLevel"
        [class.nav_itemList-open]="openedItems.includes(firstLevelItem)"
    >
        <ng-container *ngFor="let secondLevelItem of firstLevelItem.children">
            <ng-container *ngIf="!secondLevelItem.hidden">
                <a
                    *ngIf="secondLevelItem.route; else secondLevelItemTpl"
                    [routerLink]="secondLevelItem.route.path"
                    [queryParams]="secondLevelItem.route.queryParams"
                    class="nav_link"
                >
                    <ng-container
                        *ngTemplateOutlet="secondLevelItemTpl"
                    ></ng-container>
                </a>
                <ng-template #secondLevelItemTpl>
                    <div
                        class="nav_item nav_item-secondLevel"
                        [class.nav_item-open]="
                            openedItems.includes(secondLevelItem)
                        "
                        [class.nav_item-active]="
                            activeNavItems.includes(secondLevelItem)
                        "
                        (click)="handleItemClick(secondLevelItem, 2)"
                    >
                        <div class="nav_itemLabel">
                            {{ secondLevelItem.label }}
                        </div>
                        <i
                            *ngIf="
                                secondLevelItem.route == null &&
                                secondLevelItem.children != null &&
                                secondLevelItem.children.length > 0
                            "
                            nz-icon
                            nzType="picto:angle-down"
                            class="nav_iconChild"
                        ></i>
                    </div>
                </ng-template>
                <div
                    class="nav_itemList nav_itemList-thirdLevel"
                    [class.nav_itemList-open]="
                        openedItems[1] === secondLevelItem
                    "
                >
                    <ng-container
                        *ngFor="let thirdLevelItem of secondLevelItem.children"
                    >
                        <a
                            *ngIf="!thirdLevelItem.hidden"
                            [routerLink]="thirdLevelItem.route.path"
                            [queryParams]="thirdLevelItem.route.queryParams"
                            class="nav_link"
                        >
                            <div
                                class="nav_item nav_item-thirdLevel"
                                [class.nav_item-active]="
                                    activeNavItems.includes(thirdLevelItem)
                                "
                            >
                                <div class="nav_itemLabel">
                                    {{ thirdLevelItem.label }}
                                </div>
                            </div>
                        </a>
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
    </div>
</ng-template>
